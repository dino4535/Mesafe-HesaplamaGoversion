// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

// Kullanıcı ve Kimlik Doğrulama
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole @default(EMPLOYEE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  employee Employee?

  @@map("users")
}

enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
}

// Departman
model Department {
  id          String     @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employees   Employee[]

  @@map("departments")
}

// Personel Bilgileri
model Employee {
  id           String    @id @default(uuid())
  userId       String    @unique
  firstName    String
  lastName     String
  tcNo         String    @unique
  phone        String
  address      String?
  birthDate    DateTime?
  hireDate     DateTime
  position     String
  departmentId String
  salary       Decimal   @db.Decimal(18, 2)
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  department      Department       @relation(fields: [departmentId], references: [id])
  timeRecords     TimeRecord[]
  leaveRequests   LeaveRequest[]
  expenseRequests ExpenseRequest[]
  surveyResponses SurveyResponse[]

  @@map("employees")
}

// Puantaj (Zaman Kayıtları)
model TimeRecord {
  id         String    @id @default(uuid())
  employeeId String
  date       DateTime
  checkIn    DateTime?
  checkOut   DateTime?
  totalHours Decimal?  @db.Decimal(5, 2)
  notes      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("time_records")
}

// İzin Talepleri
model LeaveRequest {
  id          String             @id @default(uuid())
  employeeId  String
  leaveType   LeaveType
  startDate   DateTime
  endDate     DateTime
  totalDays   Int
  reason      String
  status      RequestStatus      @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  rejectedAt  DateTime?
  notes       String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("leave_requests")
}

enum LeaveType {
  ANNUAL
  SICK
  MATERNITY
  PATERNITY
  UNPAID
  OTHER
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

// Harcama Talepleri
model ExpenseRequest {
  id          String        @id @default(uuid())
  employeeId  String
  title       String
  description String
  amount      Decimal       @db.Decimal(18, 2)
  category    String
  receiptUrl  String?
  status      RequestStatus @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  rejectedAt  DateTime?
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("expense_requests")
}

// Anket Sistemi
model Survey {
  id          String           @id @default(uuid())
  title       String
  description String?
  isActive    Boolean          @default(true)
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  questions SurveyQuestion[]
  responses SurveyResponse[]

  @@map("surveys")
}

model SurveyQuestion {
  id           String                @id @default(uuid())
  surveyId     String
  questionText String
  questionType SurveyQuestionType
  options      String? // JSON array for multiple choice
  isRequired   Boolean               @default(false)
  order        Int
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt

  survey  Survey         @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  answers SurveyAnswer[]

  @@map("survey_questions")
}

enum SurveyQuestionType {
  TEXT
  MULTIPLE_CHOICE
  RATING
  YES_NO
}

model SurveyResponse {
  id         String   @id @default(uuid())
  surveyId   String
  employeeId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  survey   Survey         @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  employee Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  answers  SurveyAnswer[]

  @@unique([surveyId, employeeId])
  @@map("survey_responses")
}

model SurveyAnswer {
  id         String   @id @default(uuid())
  responseId String
  questionId String
  answerText String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  response SurveyResponse @relation(fields: [responseId], references: [id], onDelete: Cascade)
  question SurveyQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@map("survey_answers")
}

// BPM İş Akışları
model Workflow {
  id          String   @id @default(uuid())
  name        String
  description String?
  definition  String   @db.Text // JSON definition of the workflow
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  instances WorkflowInstance[]

  @@map("workflows")
}

model WorkflowInstance {
  id         String         @id @default(uuid())
  workflowId String
  status     WorkflowStatus @default(RUNNING)
  currentStep String?
  data       String         @db.Text // JSON data
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  workflow Workflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@map("workflow_instances")
}

enum WorkflowStatus {
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}
